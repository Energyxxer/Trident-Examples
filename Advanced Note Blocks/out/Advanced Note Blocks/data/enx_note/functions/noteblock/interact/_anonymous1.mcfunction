tag @s remove interact
tag @s add ui_open
summon minecraft:area_effect_cloud ~ ~0.1 ~ {Age:-2147483648,Duration:-1,WaitTime:-2147483648,Radius:0.0f,Particle:"",CustomNameVisible:1b,CustomName:"\"$STATE$\"",Passengers:[{Tags:["trident-entity.enx_note.note_hitbox","trident-component.enx_util.enx_note_datakill_on_link_broken","trident-component.enx_util.enx_note_link_holder","trident-component.enx_util.enx_note_unlinked","trident-component.enx_util.invisible"],Silent:1b,ActiveEffects:[{Id:14b,Duration:200000,Amplifier:0b,ShowParticles:0b},{Id:11b,Duration:1000000,Amplifier:5b,ShowParticles:0b}],DeathLootTable:"minecraft:empty",id:"minecraft:bat"}],Tags:["trident-entity.enx_note.note_button","trident-component.enx_util.enx_note_kill_on_link_broken","trident-component.enx_util.enx_note_link_holder","trident-component.enx_util.enx_note_unlinked","trident-component.enx_note.note_button_main"]}
execute if entity @s[tag=change_note] run data modify entity @e[type=minecraft:area_effect_cloud,tag=trident-entity.enx_note.note_button,tag=trident-component.enx_util.enx_note_unlinked,distance=..3,limit=1] CustomName set value "[{\"text\":\"<\",\"color\":\"dark_gray\"},{\"text\":\"Note\",\"color\":\"green\"},\">\"]"
execute if entity @s[tag=!change_note] run data modify entity @e[type=minecraft:area_effect_cloud,tag=trident-entity.enx_note.note_button,tag=trident-component.enx_util.enx_note_unlinked,distance=..3,limit=1] CustomName set value "[{\"text\":\"<\",\"color\":\"dark_gray\"},{\"text\":\"Instrument\",\"color\":\"light_purple\"},\">\"]"
scoreboard players operation PARENT enx_note_link = @s enx_note_id
execute positioned ~-0.5 ~ ~-0.5 as @e[type=minecraft:area_effect_cloud,tag=trident-entity.enx_note.note_button,distance=..3.001,tag=trident-component.enx_util.enx_note_unlinked,sort=nearest,limit=1,dx=2,dy=3,dz=2] run function enx_util:id_system/enx_note_link_holder/set_link
execute as @e[type=minecraft:bat,tag=trident-entity.enx_note.note_hitbox,distance=..3.001,tag=trident-component.enx_util.enx_note_unlinked,sort=nearest,limit=1,dx=1,dy=3,dz=1] run function enx_util:id_system/enx_note_link_holder/set_link
